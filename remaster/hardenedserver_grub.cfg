set timeout=5
set default=0
set fallback=2
set pager=1

if loadfont /boot/sabayon/unicode.pf2 ; then
   set gfxmode=auto
   insmod efi_gop
   insmod efi_uga
   insmod gfxterm
   terminal_output gfxterm
   insmod gettext
fi

if [ -f /boot/sabayon/default-splash.png ]; then
   insmod png
   background_image -m stretch /boot/sabayon/default-splash.png
fi

if [ x$bootlang = x ]; then
   bootlang=en_US
   export bootlang
fi
if [ x$bootkeymap = x ]; then
   bootkeymap=us
   export bootkeymap
fi

if [ x$acpi_opt = x ]; then
   acpi_opt=''
   export acpi_opt
fi
if [ x$modeset_opt = x ]; then
   modeset_opt=''
   export modeset_opt
fi

menuentry "Start Sabayon __VERSION__ HardenedServer" {
   set gfxpayload=keep
   echo "Starting $chosen"
   echo "Language: ${bootlang}"
   echo "Keyboard: ${bootkeymap}"
   echo "Please wait..."
   linux /boot/sabayon aufs init=/linuxrc cdroot looptype=squashfs loop=/livecd.squashfs splash=verbose,theme:sabayon __KMS__ console=tty1 quiet console-setup/layoutcode=${bootkeymap} locale=${bootlang} ${modeset_opt} ${acpi_opt} -- 
   initrd /boot/sabayon.igz
}

menuentry "Installation" {
   set gfxpayload=keep
   echo "Starting $chosen"
   echo "Language: ${bootlang}"
   echo "Keyboard: ${bootkeymap}"
   echo "Please wait..."
   linux /boot/sabayon aufs init=/linuxrc cdroot looptype=squashfs loop=/livecd.squashfs splash=verbose,theme:sabayon __KMS__ console=tty1 quiet console-setup/layoutcode=${bootkeymap} installer-gui locale=${bootlang} ${modeset_opt} ${acpi_opt} -- 
   initrd /boot/sabayon.igz
}


submenu "Advanced Options" {

   menuentry "Console mode" {
      set gfxpayload=keep
      echo "Starting $chosen"
      echo "Language: ${bootlang}"
      echo "Keyboard: ${bootkeymap}"
      echo "Please wait..."
      linux /boot/sabayon aufs init=/linuxrc cdroot looptype=squashfs loop=/livecd.squashfs splash=verbose,theme:sabayon __KMS__ console=tty1 quiet console-setup/layoutcode=${bootkeymap} gentoo=nox nox locale=${bootlang} ${modeset_opt} ${acpi_opt} -- 
      initrd /boot/sabayon.igz
   }

   menuentry "Check disc for defects" {
      set gfxpayload=keep
      echo "Starting $chosen"
      echo "Language: ${bootlang}"
      echo "Keyboard: ${bootkeymap}"
      echo "Please wait..."
      linux /boot/sabayon aufs init=/linuxrc cdroot looptype=squashfs loop=/livecd.squashfs splash=verbose,theme:sabayon __KMS__ console=tty1 quiet console-setup/layoutcode=${bootkeymap} locale=${bootlang} ${modeset_opt} ${acpi_opt} -- 
      initrd /boot/sabayon.igz
   }

   menuentry "Disable Kernel Mode Settings (for AMD Radeon GPUs with fglrx)" {
      echo "Disabling Kernel Mode Setting..."
      set modeset_opt="nomodeset"
      export modeset_opt
      configfile /boot/sabayon/grub.cfg
   }

   menuentry "Disable ACPI" {
      echo "Disabling ACPI..."
      set acpi_opt="nomodeset"
      export acpi_opt
      configfile /boot/sabayon/grub.cfg
   }

   menuentry "Debug mode" {
      set gfxpayload=keep
      echo "Starting $chosen"
      echo "Language: ${bootlang}"
      echo "Keyboard: ${bootkeymap}"
      echo "Please wait..."
      linux /boot/sabayon aufs init=/linuxrc cdroot looptype=squashfs loop=/livecd.squashfs console=tty1 debug console-setup/layoutcode=${bootkeymap} locale=${bootlang} ${modeset_opt} ${acpi_opt} --
      initrd /boot/sabayon.igz
   }

   menuentry "Memory test" {
      linux16 /boot/memtest
   }

}

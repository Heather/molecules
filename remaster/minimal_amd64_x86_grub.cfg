set timeout=5
set default=0
set fallback=2
set pager=1

if loadfont /boot/grub/unicode.pf2 ; then
   set gfxmode=auto
   insmod efi_gop
   insmod efi_uga
   insmod gfxterm
   terminal_output gfxterm
   insmod gettext
fi

if [ -f /boot/grub/default-splash.png ]; then
   insmod png
   background_image -m stretch /boot/grub/default-splash.png
fi

if [ x$bootlang = x ]; then
   bootlang=en_US
   export bootlang
fi
if [ x$bootkeymap = x ]; then
   bootkeymap=us
   export bootkeymap
fi

if [ x$acpi_opt = x ]; then
   acpi_opt=''
   export acpi_opt
fi
if [ x$modeset_opt = x ]; then
   modeset_opt=''
   export modeset_opt
fi

insmod part_gpt

menuentry "Start Sabayon __VERSION__ x86_64 __FLAVOUR__" {
   set gfxpayload=keep
   echo "Starting $chosen"
   echo "Language: ${bootlang}"
   echo "Keyboard: ${bootkeymap}"
   echo "Please wait..."
   linux /boot/sabayon64 aufs init=/linuxrc cdroot looptype=squashfs loop=/livecd64.squashfs splash=silent,theme:sabayon __KMS__ console=tty1 quiet console-setup/layoutcode=${bootkeymap} locale=${bootlang} ${modeset_opt} ${acpi_opt} -- 
   initrd /boot/sabayon64.igz
}

menuentry "Start Sabayon __VERSION__ i686 __FLAVOUR__" {
   set gfxpayload=keep
   echo "Starting $chosen"
   echo "Language: ${bootlang}"
   echo "Keyboard: ${bootkeymap}"
   echo "Please wait..."
   linux /boot/sabayon32 aufs init=/linuxrc cdroot looptype=squashfs loop=/livecd32.squashfs splash=silent,theme:sabayon __KMS__ console=tty1 quiet console-setup/layoutcode=${bootkeymap} locale=${bootlang} ${modeset_opt} ${acpi_opt} -- 
   initrd /boot/sabayon32.igz
}

menuentry "Start Sabayon __VERSION__ x86_64 Media Center" {
   set gfxpayload=keep
   echo "Starting $chosen"
   echo "Language: ${bootlang}"
   echo "Keyboard: ${bootkeymap}"
   echo "Please wait..."
   linux /boot/sabayon64 aufs init=/linuxrc cdroot looptype=squashfs loop=/livecd64.squashfs splash=silent,theme:sabayon __KMS__ console=tty1 quiet console-setup/layoutcode=${bootkeymap} sabayonmce locale=${bootlang} ${modeset_opt} ${acpi_opt} -- 
   initrd /boot/sabayon64.igz
}

menuentry "Start Sabayon __VERSION__ i686 Media Center" {
   set gfxpayload=keep
   echo "Starting $chosen"
   echo "Language: ${bootlang}"
   echo "Keyboard: ${bootkeymap}"
   echo "Please wait..."
   linux /boot/sabayon32 aufs init=/linuxrc cdroot looptype=squashfs loop=/livecd32.squashfs splash=silent,theme:sabayon __KMS__ console=tty1 quiet console-setup/layoutcode=${bootkeymap} sabayonmce locale=${bootlang} ${modeset_opt} ${acpi_opt} -- 
   initrd /boot/sabayon32.igz
}

menuentry "Installation (x86_64)" {
   set gfxpayload=keep
   echo "Starting $chosen"
   echo "Language: ${bootlang}"
   echo "Keyboard: ${bootkeymap}"
   echo "Please wait..."
   linux /boot/sabayon64 aufs init=/linuxrc cdroot looptype=squashfs loop=/livecd64.squashfs splash=silent,theme:sabayon __KMS__ console=tty1 quiet console-setup/layoutcode=${bootkeymap} installer-gui locale=${bootlang} ${modeset_opt} ${acpi_opt} -- 
   initrd /boot/sabayon64.igz
}

menuentry "Installation (i686)" {
   set gfxpayload=keep
   echo "Starting $chosen"
   echo "Language: ${bootlang}"
   echo "Keyboard: ${bootkeymap}"
   echo "Please wait..."
   linux /boot/sabayon32 aufs init=/linuxrc cdroot looptype=squashfs loop=/livecd32.squashfs splash=silent,theme:sabayon __KMS__ console=tty1 quiet console-setup/layoutcode=${bootkeymap} installer-gui locale=${bootlang} ${modeset_opt} ${acpi_opt} -- 
   initrd /boot/sabayon32.igz
}


submenu "Advanced Options" {

   menuentry "Console mode (x86_64)" {
      set gfxpayload=keep
      echo "Starting $chosen"
      echo "Language: ${bootlang}"
      echo "Keyboard: ${bootkeymap}"
      echo "Please wait..."
      linux /boot/sabayon64 aufs init=/linuxrc cdroot looptype=squashfs loop=/livecd64.squashfs splash=verbose,theme:sabayon __KMS__ console=tty1 quiet console-setup/layoutcode=${bootkeymap} gentoo=nox nox locale=${bootlang} ${modeset_opt} ${acpi_opt} -- 
      initrd /boot/sabayon64.igz
   }

   menuentry "Console mode (i686)" {
      set gfxpayload=keep
      echo "Starting $chosen"
      echo "Language: ${bootlang}"
      echo "Keyboard: ${bootkeymap}"
      echo "Please wait..."
      linux /boot/sabayon32 aufs init=/linuxrc cdroot looptype=squashfs loop=/livecd32.squashfs splash=verbose,theme:sabayon __KMS__ console=tty1 quiet console-setup/layoutcode=${bootkeymap} gentoo=nox nox locale=${bootlang} ${modeset_opt} ${acpi_opt} -- 
      initrd /boot/sabayon32.igz
   }

   menuentry "Check disc for defects (x86_64)" {
      set gfxpayload=keep
      echo "Starting $chosen"
      echo "Language: ${bootlang}"
      echo "Keyboard: ${bootkeymap}"
      echo "Please wait..."
      linux /boot/sabayon64 aufs init=/linuxrc cdroot looptype=squashfs loop=/livecd64.squashfs splash=verbose,theme:sabayon __KMS__ console=tty1 quiet console-setup/layoutcode=${bootkeymap} locale=${bootlang} ${modeset_opt} ${acpi_opt} -- 
      initrd /boot/sabayon64.igz
   }

   menuentry "Check disc for defects (i686)" {
      set gfxpayload=keep
      echo "Starting $chosen"
      echo "Language: ${bootlang}"
      echo "Keyboard: ${bootkeymap}"
      echo "Please wait..."
      linux /boot/sabayon32 aufs init=/linuxrc cdroot looptype=squashfs loop=/livecd32.squashfs splash=verbose,theme:sabayon __KMS__ console=tty1 quiet console-setup/layoutcode=${bootkeymap} locale=${bootlang} ${modeset_opt} ${acpi_opt} -- 
      initrd /boot/sabayon32.igz
   }

   menuentry "Disable Kernel Mode Settings (for AMD Radeon GPUs with fglrx)" {
      echo "Disabling Kernel Mode Setting..."
      set modeset_opt="nomodeset"
      export modeset_opt
      configfile /boot/grub/grub.cfg
   }

   menuentry "Disable ACPI" {
      echo "Disabling ACPI..."
      set acpi_opt="nomodeset"
      export acpi_opt
      configfile /boot/grub/grub.cfg
   }

   menuentry "Debug mode (x86_64)" {
      set gfxpayload=keep
      echo "Starting $chosen"
      echo "Language: ${bootlang}"
      echo "Keyboard: ${bootkeymap}"
      echo "Please wait..."
      linux /boot/sabayon64 aufs init=/linuxrc cdroot looptype=squashfs loop=/livecd64.squashfs console=tty1 debug console-setup/layoutcode=${bootkeymap} locale=${bootlang} ${modeset_opt} ${acpi_opt} --
      initrd /boot/sabayon64.igz
   }

   menuentry "Debug mode (i686)" {
      set gfxpayload=keep
      echo "Starting $chosen"
      echo "Language: ${bootlang}"
      echo "Keyboard: ${bootkeymap}"
      echo "Please wait..."
      linux /boot/sabayon32 aufs init=/linuxrc cdroot looptype=squashfs loop=/livecd32.squashfs console=tty1 debug console-setup/layoutcode=${bootkeymap} locale=${bootlang} ${modeset_opt} ${acpi_opt} --
      initrd /boot/sabayon32.igz
   }

}
